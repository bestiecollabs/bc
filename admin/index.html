<!doctype html>
<html lang="en"><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Admin - Users</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;margin:24px}
  header{display:flex;gap:12px;align-items:center;margin-bottom:16px}
  input,button,select{padding:8px 10px}
  table{border-collapse:collapse;width:100%;margin-top:12px}
  th,td{border:1px solid #ddd;padding:8px}
  th{text-align:left}
  h2{margin-top:28px}
</style>
<body>
  <header>
    <h1 style="margin:0">Users</h1>
    <form id="createForm" style="margin-left:auto;display:flex;gap:8px">
      <input type="email" id="email" placeholder="newuser@example.com" required />
      <button type="submit">Create</button>
    </form>
  </header>
  <div id="status"></div>

  <h2>Active</h2>
  <table><thead><tr><th>ID</th><th>Email</th><th>Username</th><th>Account type</th><th>Created</th><th>Actions</th></tr></thead><tbody id="activeRows"></tbody></table>

  <h2>Suspended</h2>
  <table><thead><tr><th>ID</th><th>Email</th><th>Username</th><th>Account type</th><th>Created</th><th>Actions</th></tr></thead><tbody id="suspendedRows"></tbody></table>

  <h2>Deleted</h2>
  <table><thead><tr><th>ID</th><th>Email</th><th>Username</th><th>Account type</th><th>Created</th><th>Actions</th></tr></thead><tbody id="deletedRows"></tbody></table>

  
<script type="module" src="./app.js"></script>
</body></html>







<script>
(() => {
  const byHeading = (name) => {
    const n = String(name).toLowerCase();
    const hs = Array.from(document.querySelectorAll("h2,h3"));
    const h = hs.find(el => el.textContent.trim().toLowerCase() === n);
    if (!h) return null;
    let el = h.nextElementSibling;
    while (el && el.tagName !== "TABLE") el = el.nextElementSibling;
    return el || null;
  };

  const tables = {
    active: byHeading("Active"),
    suspended: byHeading("Suspended"),
    deleted: byHeading("Deleted"),
  };
  const bodies = Object.fromEntries(Object.entries(tables).map(([k,t]) => [k, t ? (t.querySelector("tbody") || t.appendChild(document.createElement("tbody"))) : null]));

  const fmtDate = (s) => {
    if (!s) return "";
    try { return new Date(s).toLocaleString(); } catch { return String(s); }
  };

  const mkRow = (u) => {
    const tr = document.createElement("tr");
    const cells = [
      u.id ?? "",
      u.email ?? "",
      u.username ?? "",
      u.role ?? u.account_type ?? "",
      fmtDate(u.created_at ?? u.createdAt),
    ].map(v => `<td>${String(v)}</td>`).join("");
    tr.innerHTML = cells + `<td></td>`; // actions column placeholder
    return tr;
  };

  async function load() {
    const r = await fetch("/api/admin/users", { credentials: "include" });
    if (!r.ok) { console.warn("admin/users fetch failed", r.status); return; }
    const data = await r.json().catch(() => ({}));
    const users = Array.isArray(data.users) ? data.users : [];

    if (bodies.active) bodies.active.innerHTML = "";
    if (bodies.suspended) bodies.suspended.innerHTML = "";
    if (bodies.deleted) bodies.deleted.innerHTML = "";

    for (const u of users) {
      const st = String(u.status || "active").toLowerCase();
      const bucket = st.includes("suspend") ? "suspended" : (st.includes("delete") ? "deleted" : "active");
      const tb = bodies[bucket];
      if (tb) tb.appendChild(mkRow(u));
    }
    console.log(`Admin users loaded: ${users.length}`);
  }

  window.addEventListener("DOMContentLoaded", load);
})();
</script>
