<!doctype html>
<html lang="en"><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Admin - Users</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;margin:24px}
  header{display:flex;gap:12px;align-items:center;margin-bottom:16px}
  input,button,select{padding:8px 10px}
  table{border-collapse:collapse;width:100%;margin-top:12px}
  th,td{border:1px solid #ddd;padding:8px}
  th{text-align:left}
  h2{margin-top:28px}
</style>
<body>
  <header>
    <h1 style="margin:0">Users</h1>
    <form id="createForm" style="margin-left:auto;display:flex;gap:8px">
      <input type="email" id="email" placeholder="newuser@example.com" required />
      <button type="submit">Create</button>
    </form>
  </header>
  <div id="status"></div>

  <h2>Active</h2>
  <table><thead><tr><th>ID</th><th>Email</th><th>Username</th><th>Account type</th><th>Created</th><th>Actions</th></tr></thead><tbody id="activeRows"></tbody></table>

  <h2>Suspended</h2>
  <table><thead><tr><th>ID</th><th>Email</th><th>Username</th><th>Account type</th><th>Created</th><th>Actions</th></tr></thead><tbody id="suspendedRows"></tbody></table>

  <h2>Deleted</h2>
  <table><thead><tr><th>ID</th><th>Email</th><th>Username</th><th>Account type</th><th>Created</th><th>Actions</th></tr></thead><tbody id="deletedRows"></tbody></table>

  
<script type="module" src="./app.js"></script>
</body></html>





<script>
// Minimal client glue for the unified /api/admin/users route
const $ = s => document.querySelector(s);
const tbody = document.querySelector("#tbl tbody") || document.createElement("tbody");
const statusEl = document.querySelector("#status") || document.createElement("p");

async function loadUsers() {
  statusEl.textContent = "Loading";
  const r = await fetch("/api/admin/users", { credentials: "include" });
  if (!r.ok) { statusEl.textContent = "Unauthorized or error"; return; }
  const { users = [] } = await r.json();
  if (tbody) tbody.innerHTML = "";
  users.forEach(u => {
    const tr = document.createElement("tr");
    tr.innerHTML = [
      u.id ?? "", u.email ?? "", u.username ?? "", u.status ?? "",
      u.role ?? "", u.is_admin ?? "", u.created_at ?? ""
    ].map(v => `<td>${String(v)}</td>`).join("")
      + `<td><button class="del" data-id="${u.id}">Delete</button></td>`;
    tbody.appendChild(tr);
  });
  statusEl.textContent = `Rows: ${users.length}`;
}

document.addEventListener("click", async (e) => {
  const btn = e.target.closest("button.del");
  if (!btn) return;
  const id = btn.getAttribute("data-id");
  btn.disabled = true;
  const r = await fetch(`/api/admin/users?id=${encodeURIComponent(id)}`, { method: "DELETE", credentials: "include" });
  if (r.ok) loadUsers(); else btn.disabled = false;
});

window.addEventListener("DOMContentLoaded", loadUsers);
</script>
